<!DOCTYPE html>
<html>
<head>
    <title>CORS Test - Chung Tay Ph√≤ng Ng·ª´a</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>üáªüá≥ CORS Test - Vietnamese Drug Prevention Platform</h1>
    <p>Testing Cross-Origin Resource Sharing for public endpoints</p>
    
    <div id="results">
        <div class="test-result loading">Testing endpoints...</div>
    </div>

    <script>
    $(document).ready(function() {
        const baseUrl = 'http://localhost:8080/api';
        const results = $('#results');
        
        function addResult(test, status, data) {
            const cssClass = status === 'success' ? 'success' : 'error';
            const icon = status === 'success' ? '‚úÖ' : '‚ùå';
            results.append(`
                <div class="test-result ${cssClass}">
                    ${icon} <strong>${test}</strong>: ${data}
                </div>
            `);
        }
        
        // Clear loading message
        results.empty();
        
        // Test 1: Survey Health Endpoint
        $.ajax({
            url: baseUrl + '/surveys/health',
            method: 'GET',
            dataType: 'json'
        }).done(function(data) {
            addResult('Survey Health Check', 'success', 
                `Status: ${data.status}, Service: ${data.service}, CORS: ${data.cors || 'not specified'}`);
        }).fail(function(jqXHR, textStatus, errorThrown) {
            addResult('Survey Health Check', 'error', 
                `HTTP ${jqXHR.status}: ${textStatus} - ${errorThrown}`);
        });
        
        // Test 2: Public Surveys Endpoint
        $.ajax({
            url: baseUrl + '/surveys/public',
            method: 'GET',
            dataType: 'json'
        }).done(function(data) {
            addResult('Public Surveys', 'success', 
                `Success: ${data.success}, Message: ${data.message}`);
        }).fail(function(jqXHR, textStatus, errorThrown) {
            addResult('Public Surveys', 'error', 
                `HTTP ${jqXHR.status}: ${textStatus} - ${errorThrown}`);
        });
        
        // Test 3: Actuator Health (working baseline)
        $.ajax({
            url: baseUrl + '/actuator/health',
            method: 'GET',
            dataType: 'json'
        }).done(function(data) {
            addResult('Actuator Health (Baseline)', 'success', 
                `Status: ${data.status}, DB: ${data.components.db.status}`);
        }).fail(function(jqXHR, textStatus, errorThrown) {
            addResult('Actuator Health (Baseline)', 'error', 
                `HTTP ${jqXHR.status}: ${textStatus} - ${errorThrown}`);
        });
        
        // Test 4: CORS Preflight Test
        $.ajax({
            url: baseUrl + '/surveys/health',
            method: 'OPTIONS',
            headers: {
                'Origin': 'http://localhost:3000',
                'Access-Control-Request-Method': 'GET'
            }
        }).done(function(data, textStatus, jqXHR) {
            const corsHeaders = jqXHR.getResponseHeader('Access-Control-Allow-Origin');
            addResult('CORS Preflight', 'success', 
                `Allow-Origin: ${corsHeaders || 'not found'}`);
        }).fail(function(jqXHR, textStatus, errorThrown) {
            addResult('CORS Preflight', 'error', 
                `HTTP ${jqXHR.status}: ${textStatus} - ${errorThrown}`);
        });
    });
    </script>
</body>
</html> 